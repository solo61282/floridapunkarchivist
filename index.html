<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Hit Play - Videos</title>
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&display=swap" rel="stylesheet">
<style>
* { margin:0; padding:0; box-sizing:border-box; }
body { font-family:'Bebas Neue', Arial, sans-serif; background:#000; color:#fff; text-align:center; }
.hero { padding:2rem; }
.hero-logo { width:200px; max-width:70%; margin:0 auto; display:block; }
.videos-section { background:#111; padding:1rem; }
.videos-section h2 { font-size:2.3rem; margin-bottom:1rem; }
.video-list { display:grid; gap:1rem; padding:0 1rem; grid-template-columns:repeat(auto-fit, minmax(250px, 1fr)); justify-content:center; }
@media (min-width:1024px) { .video-list { grid-template-columns:repeat(4,1fr); } }
.video-item { position:relative; cursor:pointer; border-radius:10px; overflow:hidden; background:#000; min-height:150px; }
.video-thumb, iframe { width:100%; aspect-ratio:16/9; object-fit:cover; display:block; border-radius:10px; }
.play-overlay { position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); font-size:4rem; color:rgba(255,255,255,0.85); pointer-events:none; text-shadow:0 0 20px #000; }
.video-title { position:absolute; bottom:0; left:0; width:100%; padding:0.3rem 0.5rem; color:#fff; font-size:0.9rem; line-height:1.2; background:linear-gradient(to top, rgba(0,0,0,0.7), rgba(0,0,0,0)); white-space:normal; border-bottom-left-radius:10px; border-bottom-right-radius:10px; }
.footer { padding:2rem 1rem; font-size:1.2rem; }
.footer a { color:#00aaff; text-decoration:none; }
.footer a:hover { text-decoration:underline; }
</style>
</head>
<body>

<div class="hero" id="heroLogoContainer"></div>

<div class="videos-section">
  <h2>VIDEOS</h2>
  <div id="videoList" class="video-list"></div>
</div>

<div class="footer">
  More from the 
  <a href="https://www.youtube.com/channel/UC63N1yWiGhzL2E9hcfFDJoQ" target="_blank">
    Florida Punk Archivist
  </a>
</div>

<script>
const API_KEY = "AIzaSyAr8RIreQq2cnTLAKJCUSaRqpvycY7-by8"; 
const CHANNEL_ID = "UC63N1yWiGhzL2E9hcfFDJoQ";

let uploadsPlaylistId = "";
let nextPageToken = "";
let loading = false;

const videoListDiv = document.getElementById("videoList");
const heroLogoContainer = document.getElementById("heroLogoContainer");

// Lazy load observer
const lazyObserver = new IntersectionObserver(entries => {
  entries.forEach(entry => {
    if(entry.isIntersecting){
      const img = entry.target;
      if(img.dataset.src){
        img.src = img.dataset.src;
        img.removeAttribute('data-src');
      }
      lazyObserver.unobserve(img);
    }
  });
},{ rootMargin:"200px 0px" });

// Load channel logo and uploads playlist ID
async function loadChannelData() {
  try {
    const res = await fetch(`https://www.googleapis.com/youtube/v3/channels?part=snippet,contentDetails&id=${CHANNEL_ID}&key=${API_KEY}`);
    const data = await res.json();
    if(data.items && data.items.length>0){
      const channel = data.items[0];
      const logoUrl = channel.snippet.thumbnails.high.url;
      const img = document.createElement("img");
      img.src = logoUrl;
      img.alt = "Channel Logo";
      img.className = "hero-logo";
      heroLogoContainer.appendChild(img);

      uploadsPlaylistId = channel.contentDetails.relatedPlaylists.uploads;
      loadVideos(); // start loading videos once we have the uploads playlist
    }
  } catch(err){ console.error(err); }
}
loadChannelData();

// Load videos from uploads playlist
async function loadVideos() {
  if(loading || !uploadsPlaylistId) return;
  loading = true;

  const url = `https://www.googleapis.com/youtube/v3/playlistItems?part=snippet&playlistId=${uploadsPlaylistId}&maxResults=10&pageToken=${nextPageToken}&key=${API_KEY}`;
  try {
    const res = await fetch(url);
    const data = await res.json();
    nextPageToken = data.nextPageToken || "";

    data.items.forEach(item => {
      const vid = item.snippet.resourceId.videoId;
      const thumbUrl = item.snippet.thumbnails.maxres?.url || item.snippet.thumbnails.high.url;
      const title = item.snippet.title;

      const container = document.createElement("div");
      container.className = "video-item";
      container.innerHTML = `
        <img class="video-thumb" data-src="${thumbUrl}" alt="">
        <div class="play-overlay">â–¶</div>
        <div class="video-title">${title}</div>
      `;
      videoListDiv.appendChild(container);

      const img = container.querySelector(".video-thumb");
      lazyObserver.observe(img);

      // Click to play
      container.addEventListener("click", () => {
        const iframe = document.createElement("iframe");
        iframe.src = `https://www.youtube.com/embed/${vid}?autoplay=1`;
        iframe.allowFullscreen = true;
        iframe.style.width = "100%";
        iframe.style.height = "100%";
        container.innerHTML = "";
        container.appendChild(iframe);
      });

      // Hover preview on desktop
      if(window.innerWidth >= 768){
        container.addEventListener("mouseenter", () => {
          if(!container.querySelector("iframe.preview")){
            const preview = document.createElement("iframe");
            preview.className = "preview";
            preview.src = `https://www.youtube.com/embed/${vid}?autoplay=1&mute=1&controls=0&loop=1&playlist=${vid}`;
            preview.style.width = "100%";
            preview.style.height = "100%";
            preview.style.position = "absolute";
            preview.style.top = 0;
            preview.style.left = 0;
            preview.style.pointerEvents = "none";
            container.appendChild(preview);
          }
        });
        container.addEventListener("mouseleave", () => {
          const preview = container.querySelector("iframe.preview");
          if(preview) preview.remove();
        });
      }
    });

  } catch(err){ console.error(err); }
  loading = false;
}

// Infinite scroll
window.addEventListener("scroll", () => {
  if(window.innerHeight + window.scrollY >= document.body.offsetHeight-300 && nextPageToken && !loading){
    loadVideos();
  }
});
</script>

</body>
</html>
